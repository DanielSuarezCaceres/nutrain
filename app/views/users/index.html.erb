<div class="d-flex justify-content-center table-title">
  <h3>Users</h3>
</div>
<div class="table-responsive">
  <table class="table table-hover">
    <tr>
      <th class="text-center">Name</th>
      <th class="text-center">Lastname</th>
      <th class="text-center">Age</th>
      <th class="text-center">Gender</th>
      <th class="text-center">Phone</th>
      <th class="text-center">City</th>
      <th class="text-center">Country</th>
      <th class="text-center">Actions</th>
      <% if current_user.type == 'Admin' %>
        <th>Administration</th>
      <% end %>
    </tr>
    <tbody>
      <% @users.each do |user| %>
        <tr>
          <td class="text-center"><%= user.name %></td>
          <td class="text-center"><%= user.lastname %></td>
          <td class="text-center"><%= user.age %></td>
          <td class="text-center"><%= user.gender %></td>
          <td class="text-center"><%= user.phone %></td>
          <td class="text-center"><%= user.city %></td>
          <td class="text-center"><%= user.country %></td>
          <% if current_user.type == 'Admin' %>
            <td class="text-center">
              <%= link_to 'View', user_path(user), class: 'btn' %>
              <%= link_to 'Edit', edit_user_registration_path(user), class: 'btn' %>
              <%= link_to 'Delete', user_path(user), method: :delete, class: 'btn btn-danger' %>
            </td>
          <% elsif current_user.type == 'Professional' %>
            <td class="text-center">
              <%= link_to 'Details', user_client_path(user_id: current_user.id, id: user.id), class: 'btn' %>
              <!-- appointments can be made without existing a contract between professional and user -->
              <%= link_to 'New appointment', new_user_appointment_path(user_id: current_user.id, client_id: user.id), class: 'btn' %>
              <% if current_user.has_contract?(user.id) %>
                <%= link_to Contract.get_contract_message(user.id, current_user.id), 
                  edit_user_contract_path(user_id: current_user, id: Contract.where(professiona_id: current_user.id, client_id: user.id)),
                  class: 'btn btn-danger' %>
              <% else %>
                <%= link_to 'Contract request', new_user_contract_path(user_id: current_user.id, client_id: user.id), class: 'btn' %>
              <% end %>
            </td>
          <!-- CHECK THIS ELSE, MAYBE NEEDS TO SHOW DETAILS BUTTON ONLY -->
          <% else %>
            <td class="text-center">
              <%= link_to 'Details', user_path(user), class: 'btn' %>
              <%= link_to 'New appointment', new_user_appointment_path(user_id: current_user.id, professional_id: user.id), class: 'btn' %>
             <% if current_user.has_contract?(user.id) %>
                <%= link_to Contract.get_contract_message(current_user.id, user.id), 
                  edit_user_contract_path(user_id: current_user, id: Contract.where(professiona_id: user.id, client_id: current_user.id)),
                  class: 'btn btn-danger' %>
              <% else %>
                <%= link_to 'Contract request', new_user_contract_path(user_id: current_user.id, client_id: user.id), class: 'btn' %>
              <% end %>
            </td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<%== pagy_bootstrap_nav(@pagy).html_safe %>